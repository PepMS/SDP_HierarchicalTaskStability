% syms p11 p21 p31 p22 p32 p33
% syms a11 a21 a31 a12 a22 a32 a13 a23 a33
% 
% P = [p11 p21 p31; p21 p22 p32; p31 p32 p33];
% A = [a11 a12 a13; a21 a22 a23; a31 a32 a33];
% 
% V = transpose(A)*P+P*A;

%% Solve the problem

A = [-1 2 0; -3 -4 1; 0 0 -2];

nVars = 7; % Number of varaibles
nBlock = 3; % Number of LMIs
blockStruct = [3 3 3]; % Positive since it is symmetric
F = cell(nBlock, nVars + 1);

% Cost function (minimize lambda)
c = [0 0 0 0 0 0 1];

F{1,2} = -[2*A(1,1), A(1,2)       ,  A(1,3);         A(1,2),         0,          0;              A(1,3),         0,              0]; %p11
F{1,3} = -[2*A(2,1), A(1,1)+A(2,2),  A(2,3);         A(1,1)+A(2,2),  2*A(1,2),   A(1,3);         A(2,3),         A(1,3),         0]; %p21
F{1,4} = -[2*A(3,1), A(3,2),         A(1,1)+A(3,3);  A(3,1),         0,          A(1,2);         A(1,1)+A(3,3),  A(1,2),         2*A(1,3)]; %p31
F{1,5} = -[0,        A(2,1),         0;              A(2,1),         2*A(2,2),   A(2,3);         0,              A(2,3),         0]; %p22
F{1,6} = -[0,        A(3,1),         A(2,1);         A(3,1),         2*A(3,2),   A(2,2)+A(3,3);  A(2,1),         A(2,2)+A(3,3),  2*A(2,3)]; %p32
F{1,7} = -[0,        0,              A(3,1);         0,              0,          A(3,2);         A(3,1),         A(3,2),         2*A(3,3)]; %p33   

%F{2,1} = 0.1*eye(3);
F{2,2} = [1 0 0; 0 0 0; 0 0 0];
F{2,3} = [0 1 0; 1 0 0; 0 0 0];
F{2,4} = [0 0 1; 0 0 0; 1 0 0];
F{2,5} = [0 0 0; 0 1 0; 0 0 0];
F{2,6} = [0 0 0; 0 0 1; 0 1 0];
F{2,7} = [0 0 0; 0 0 0; 0 0 1];

F{3,2} = -[1 0 0; 0 0 0; 0 0 0];
F{3,3} = -[0 1 0; 1 0 0; 0 0 0];
F{3,4} = -[0 0 1; 0 0 0; 1 0 0];
F{3,5} = -[0 0 0; 0 1 0; 0 0 0];
F{3,6} = -[0 0 0; 0 0 1; 0 1 0];
F{3,7} = -[0 0 0; 0 0 0; 0 0 1];
F{3,8} = eye(3);

% Solve
OPTION.print = '';
[objVal, xOpt, X, Y, INFO] = sdpam(nVars, nBlock, blockStruct, c, F, OPTION);

P = [xOpt(1)/2 xOpt(2) xOpt(3); 0 xOpt(4)/2 xOpt(5);0 0 xOpt(6)/2];
P = P + P';

eig(P)
eig(A'*P + P*A)